<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Ngitung</title>
    <!-- Path to Framework7 Library CSS-->
    <link rel="stylesheet" href="css/framework7.ios.min.css">
    <link rel="stylesheet" href="css/framework7.ios.colors.min.css">
    <!-- Path to your custom app styles-->
    <link rel="stylesheet" href="css/my-app.css">
    <style type="text/css">
      .img-wrapper{
          position: relative;
          overflow:hidden;
          height:250px;
      }

      .img-wrapper img{
          position: absolute;
          top:-100%; left:0; right: 0; bottom:-100%;
          margin: auto;
          width: 250px;
      }

      .list-img-wrapper{
          position: relative;
          overflow:hidden;
          height:80px;
      }

      .list-img-wrapper img{
          position: absolute;
          top:-100%; left:0; right: 0; bottom:-100%;
          /*margin: auto;*/
          width: 80px;
      }
    </style>
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function (argument) {
        
      });

      function isNumberKey(evt){
          var charCode = (evt.which) ? evt.which : evt.keyCode
          return !(charCode > 31 && (charCode < 48 || charCode > 57));
      }
      function numberWithCommas(x) {
          //remove commas
          retVal = x ? parseFloat(x.replace(/,/g, '')) : 0;
          if (retVal==0) return '';

          //apply formatting
          return retVal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }
    </script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">

      var pictureSource;   // picture source
      var destinationType; // sets the format of returned value

      // Wait for device API libraries to load
      //
      document.addEventListener("deviceready",onDeviceReady,false);

      // device APIs are available
      //
      function onDeviceReady() {
          pictureSource=navigator.camera.PictureSourceType;
          destinationType=navigator.camera.DestinationType;
      }

      // Called when a photo is successfully retrieved
      //
      function onPhotoDataSuccess(imageData) {
        // // Uncomment to view the base64-encoded image data
        // // console.log(imageData);

        // // Get image handle
        // //
        // var smallImage = document.getElementById('smallImage');

        // // Unhide image elements
        // //
        // smallImage.style.display = 'block';

        // // Show the captured photo
        // // The in-line CSS rules are used to resize the image
        // //
        // smallImage.src = imageData;

        movePic(imageData);
      }

      // Called when a photo is successfully retrieved
      //
      function onPhotoURISuccess(imageURI) {
        // Uncomment to view the image file URI
        // console.log(imageURI);

        // Get image handle
        //
        var largeImage = document.getElementById('largeImage');

        // Unhide image elements
        //
        largeImage.style.display = 'block';

        // Show the captured photo
        // The in-line CSS rules are used to resize the image
        //
        largeImage.src = imageURI;
      }

      // A button will call this function
      //
      function capturePhoto() {
        // Take picture using device camera and retrieve image as base64-encoded string
        navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50,
          destinationType: destinationType.FILE_URI, saveToPhotoAlbum: false});
      }

      // A button will call this function
      //
      function capturePhotoEdit() {
        // Take picture using device camera, allow edit, and retrieve image as base64-encoded string
        navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 20, allowEdit: true,
          destinationType: destinationType.DATA_URL });
      }

      // A button will call this function
      //
      function getPhoto(source) {
        // Retrieve image file location from specified source
        navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50,
          destinationType: destinationType.FILE_URI,
          sourceType: source });
      }

      // Called if something bad happens.
      //
      function onFail(message) {
        
      }





      var photoOriginFolder = '';
      function movePic(fileUri){ 
        filePath = fileUri.replace("file://", ""); 
        var res = filePath.split("/");
        var theStr = '';
        var until = res.length - 2;
        for (var i=1; i<until; i++) {
          theStr+='/'+res[i];
        }
        theStr = 'file://' + theStr;

        window.resolveLocalFileSystemURI(
          fileUri,
          function(fileEntry){
                newFileUri  = theStr + '/files/';
                oldFileUri  = fileUri;
                fileName = fileEntry.fullPath.replace('/','');

                window.resolveLocalFileSystemURI(newFileUri,
                        function(dirEntry) {
                            // move the pic to a new directory and rename it
                            fileEntry.moveTo(dirEntry, fileName, successMove, resOnError);

                            // change smallImage src to the new pic
                            var smallImage = document.getElementById('smallImage');
                            smallImage.style.display = 'block';
                            smallImage.src = newFileUri+'/'+fileName;
                        },
                        resOnError);
          },
          resOnError);
      } 

      //Callback function when the file has been moved successfully - inserting the complete path
      function successMove(entry) {
        // alert(entry.fullPath);
          //Store imagepath in session for future use
          // like to store it in database
          // sessionStorage.setItem('imagepath', entry.fullPath);
      }

      function resOnError(error) {
          // alert(error.code);
      }

    </script>
    <script type="text/javascript" charset="utf-8">
      //Test for browser compatibility
      if (window.openDatabase) {
          var mydb = openDatabase("toong", "0.1", "Toong DB", 1024 * 1024 * 50);

          mydb.transaction(function (t) {
              t.executeSql("CREATE TABLE IF NOT EXISTS selling_history (id INTEGER PRIMARY KEY ASC, name, supplier, descr, pic_url, buy_price, sell_price, qty, sold_date)");
              t.executeSql("CREATE TABLE IF NOT EXISTS name (name PRIMARY KEY)");
              t.executeSql("CREATE TABLE IF NOT EXISTS supplier (name PRIMARY KEY)");
              t.executeSql("CREATE TABLE IF NOT EXISTS descr (name PRIMARY KEY)");
          });
      } else {
          alert("WebSQL is not supported by your browser!");
      }

      function addItem() {
          //check to ensure the mydb object has been created
          if (mydb) {
              //get the values of the make and model text inputs
              var name = document.getElementById("name").value;
              var supplier = document.getElementById("supplier").value;
              var descr = document.getElementById("descr").value;
              var pic_url = document.getElementById('smallImage').src;
              var buy_price = document.getElementById("buy_price").value;
              var sell_price = document.getElementById("sell_price").value;
              var qty = document.getElementById("qty").value;
              var sold_date = document.getElementById("sold_date").value;

              //Test to ensure that the user has entered both a make and model
              if (name!=="" && buy_price!=="" && sell_price!=="" && qty!=="" && sold_date!=="") {
                  //Insert the user entered details into the cars table, note the use of the ? placeholder, these will replaced by the data passed in as an array as the second parameter
                  mydb.transaction(function (t) {
                      t.executeSql("INSERT INTO selling_history (name, supplier, descr, pic_url, buy_price, sell_price, qty, sold_date) VALUES (?, ?, ?, ?, ?, ?, ?, ?)", [name, supplier, descr, pic_url, buy_price, sell_price, qty, sold_date]);
                      outputInventory();
                  });
              } else {
                  alert("You must enter a make and model!");
              }
          } else {
              alert("db not found, your browser does not support web sql!");
          }
      }
    </script>
  </head>
  <body>
    <!-- Status bar overlay for fullscreen mode-->
    <div class="statusbar-overlay"></div>
    <!-- Panels overlay-->
    <div class="panel-overlay"></div>
    <!-- Left panel with reveal effect-->
    <div class="panel panel-left panel-reveal">
      <div class="content-block">
        <p><a href="sell.html" class="button close-panel">Jual</a></p>
        <p><a href="#" class="button close-panel">TBD 1</a></p>
        <p><a href="#" class="button close-panel">TBD 2</a></p>
      </div>
    </div>
    <!-- Views-->
    <div class="views">
      <!-- Your main view, should have "view-main" class-->
      <div class="view view-main">
        <!-- Top Navbar-->
        <div class="navbar">
          <div class="navbar-inner">
            <!-- We have home navbar without left link-->
            <div class="center sliding">Riwayat Penjualan</div>
            <div class="right">
              <a href="#" class="link icon-only open-panel"> <i class="icon icon-bars"></i></a>
            </div>
          </div>
        </div>
        <!-- Pages, because we need fixed-through navbar and toolbar, it has additional appropriate classes-->
        <div class="pages navbar-through toolbar-through">
          <!-- Page, data-page contains page name-->
          <div data-page="index" class="page">
            <!-- Scrollable page content-->
            <div class="page-content">
              <div class="content-block">
                <!-- <div class="list-block">
          <ul>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-input">
                    <input type="text" placeholder="Tanggal penjualan" readonly id="sold_date">
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-input">
                    <input type="text" placeholder="Nama barang" id="name">
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-input">
                    <input type="text" placeholder="Supplier" id="supplier">
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-input">
                    <input type="text" placeholder="Keterangan" id="descr">
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-input">
                    <input type="text" placeholder="Harga beli per unit" onkeypress="return isNumberKey(event);" onkeyup="this.value=numberWithCommas(this.value);" id="buy_price">
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-input">
                    <input type="text" placeholder="Harga jual per unit" onkeypress="return isNumberKey(event);" onkeyup="this.value=numberWithCommas(this.value);" id="sell_price">
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div class="item-content">
                <div class="item-inner">
                  <div class="item-input">
                    <input type="text" placeholder="Jumlah terjual" onkeypress="return isNumberKey(event);" onkeyup="this.value=numberWithCommas(this.value);" id="qty">
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>
        <div class="img-wrapper">
            <img id="smallImage" src="img/no-image.png">
        </div>
        <p><a href="#" class="button" onclick="capturePhoto();">Ambil gambar</a></p>
        <br />
        <p><a href="#" class="button button-big button-fill color-gray" style="background-color:grey;" onclick="addItem();">Tambah penjualan</a></p> -->
                <p><a href="sell.html" class="button link">Jual</a></p>
                <div id="welcomeMessage"></div>
                <!-- <div class="list-block virtual-list media-list" id="sellingHistoryList">
                </div> -->
                <div id="sellingHistoryContainer"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Path to Framework7 Library JS-->
    <script type="text/javascript" src="js/framework7.min.js"></script>
    <!-- Path to your app js-->
    <script type="text/javascript" src="js/my-app.js"></script>
    <script type="text/javascript">
    // var calendarDefault = myApp.calendar({
    //       input: '#sold_date',
    //   });
    </script>
  </body>
</html>